<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stats</title>
    <link rel="stylesheet" href="style.css">
    <script src="stats.js"></script>
</head>

<body>
    <h1>Crew Status</h1>
    <p id="date"></p>
    <main id="crew"></main>

    <script>
    const demos_done = 14
    const ex_done = 6

    const crew_display = document.getElementById('crew')

    function get_color(amount, total){
            let value = Math.round(amount/total*100)
            if(value>90){
                return 'rgb(231, 123, 0);' //orange
            }
            if(value>80){
                return 'rgb(117, 0, 172);' //purple
            }
            if(value>65){
                return 'rgb(0, 167, 69);' //green
            }
            if(value>50){
                return 'rgb(0, 104, 189);' //blue
            }
            else{
                return 'rgb(122, 122, 122)' //grey
            }
    }
    function get_avatar(amount, total){
            let value = Math.round(amount/total*100)
            if(value>90){
                return 'orange'
            }
            if(value>80){
                return 'purple'
            }
            if(value>65){
                return 'green'
            }
            if(value>50){
                return 'blue'
            }
            else{
                return 'grey'
            }
    }
    function get_rank(amount, total){
            let value = Math.round(amount/total*100)
            if(value>90){
                return 'White Hat Hacker'
            }
            if(value>80){
                return 'Script Walker'
            }
            if(value>65){
                return 'Matrix Explorer'
            }
            if(value>50){
                return 'Agile Developer'
            }
            else{
                return 'Apprentice Developer'
            }

    }

    document.getElementById('date').innerHTML = repo_date_time
    let html_content = ''
    function sortByRowSum(array) {
    let sums = new Map(array.map(row =>
        [row, row.reduce((sum, element) => sum + element, 0)]
    ));
    return array.sort((a, b) => sums.get(a) - sums.get(b));
    }
    //sortByRowSum(members).reverse().forEach(element => {
    members.forEach(element => {
        let value = element[0] + element[1]
        if(value == 0){
            return
        }
        html_content += `<figure style="border: solid 10px ${get_color(value, demos_done+ex_done)};">
            <img src="img/${get_avatar(value, demos_done+ex_done)}.jpg" alt="img">
            <figcaption>`
        let i = 0

        value != 0 ? html_content += `<p class="total" style="width:${Math.round(value/(demos_done+ex_done)*100)}%">${value}</p>` : html_content  += ''
        element = element.reverse()
        element.forEach((e) =>{

            if(i == 0){

                // demos - excercises
                let value = Math.round(100*((e)/demos_done))
                if (value == 0){
                   html_content += `<p class="demos" style="background-color:inherit;"></p>`
                }
                else{
                    html_content += `<p class="demos" style="width:${value}%">${Math.round(e/(demos_done)*100)}%</p>`
                }

                i++;
            }
            else{
                let value = Math.round(100*((e)/ex_done))
                if (value == 0){
                   html_content += `<p class="excercises" style="background-color:inherit;"></p>`
                }
                else{
                    html_content += `<p class="excercises" style="width:${value}%">${Math.round(e/(ex_done)*100)}%</p>`
                }
            }

        })
        html_content += `</figcaption>
        <span>${get_rank(value, demos_done+ex_done)}</span>
        </figure>`
    });

    crew_display.innerHTML = html_content

    </script>
</body>
</html>